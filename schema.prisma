generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  accountTypes AccountType[]
  accounts     Account[]
  categories   Category[]
  payees       Payee[]
  transactions Transaction[]
}

model AccountType {
  id       String    @id @default(uuid())
  name     String
  priority Int       @default(99)
  user     User      @relation(fields: [userId], references: [id])
  userId   String
  accounts Account[]

  @@unique([name, userId], name: "account_type_name_user_id")
}

model Account {
  id              String        @id @default(uuid())
  name            String
  accountType     AccountType   @relation(fields: [accountTypeId], references: [id])
  accountTypeId   String
  startingDate    DateTime      @db.Date
  startingBalance Float
  user            User          @relation(fields: [userId], references: [id])
  userId          String
  transactions    Transaction[]

  @@unique([name, userId], name: "account_name_user_id")
}

model Category {
  id           String        @id @default(uuid())
  name         String
  user         User          @relation(fields: [userId], references: [id])
  userId       String
  transactions Transaction[]

  @@unique([name, userId], name: "category_name_user_id")
}

model Payee {
  id           String        @id @default(uuid())
  name         String
  user         User          @relation(fields: [userId], references: [id])
  userId       String
  transactions Transaction[]

  @@unique([name, userId], name: "payee_name_user_id")
}

model Transaction {
  id         String   @id @default(uuid())
  date       DateTime @default(now())
  category   Category @relation(fields: [categoryId], references: [id])
  categoryId String
  account    Account  @relation(fields: [accountId], references: [id])
  accountId  String
  payee      Payee    @relation(fields: [payeeId], references: [id])
  payeeId    String
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  memo       String?
  amount     Float
}
